function download(k,f,i){function e(a){var d=a.split(/[:;,]/),a=d[1],d=("base64"==d[2]?atob:decodeURIComponent)(d.pop()),h=d.length,l=0,z=new Uint8Array(h);for(l;l<h;++l)z[l]=d.charCodeAt(l);return new p([z],{type:a})}function j(d,h){if("download"in c)return c.href=d,c.setAttribute("download",a),c.innerHTML="downloading...",c.style.display="none",b.body.appendChild(c),setTimeout(function(){c.click();b.body.removeChild(c);!0===h&&setTimeout(function(){g.URL.revokeObjectURL(c.href)},250)},66),!0;var l=
b.createElement("iframe");b.body.appendChild(l);h||(d="data:"+d.replace(/^data:([\w\/\-\+]+)/,n));l.src=d;setTimeout(function(){b.body.removeChild(l)},333)}var g=window,n="application/octet-stream",i=i||n,b=document,c=b.createElement("a"),o=function(a){return""+a},p=g.Blob||g.MozBlob||g.WebKitBlob||o,h=g.MSBlobBuilder||g.WebKitBlobBuilder||g.BlobBuilder,a=f||"download",d;"true"===""+this&&(k=[k,i],i=k[0],k=k[1]);if((""+k).match(/^data\:[\w+\-]+\/[\w+\-]+[,;]/))return navigator.msSaveBlob?navigator.msSaveBlob(e(k),
a):j(k);try{d=k instanceof p?k:new p([k],{type:i})}catch(l){h&&(d=new h,d.append([k]),d=d.getBlob(i))}if(navigator.msSaveBlob)return navigator.msSaveBlob(d,a);if(g.URL)j(g.URL.createObjectURL(d),!0);else{if("string"===typeof d||d.constructor===o)try{return j("data:"+i+";base64,"+g.btoa(d))}catch(z){return j("data:"+i+","+encodeURIComponent(d))}f=new FileReader;f.onload=function(){j(this.result)};f.readAsDataURL(d)}return!0};window.Whammy=function(){function k(h,a){for(var d=f(h),d=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1E6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:o(d.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},
{data:1,id:131},{id:224,data:[{data:d.width,id:176},{data:d.height,id:186}]}]}]},{id:475249515,data:[]}]}],l=d[1],z=l.data[2],b=0,g=0;b<h.length;){var e={id:187,data:[{data:Math.round(g),id:179},{id:183,data:[{data:1,id:247},{data:0,size:8,id:241}]}]};z.data.push(e);var c=[],e=0;do c.push(h[b]),e+=h[b].duration,b++;while(b<h.length&&3E4>e);var i=0,c={id:524531317,data:[{data:Math.round(g),id:231}].concat(c.map(function(a){var d=n({discardable:0,frame:a.data.slice(4),invisible:0,keyframe:1,lacing:0,
trackNum:1,timecode:Math.round(i)});i+=a.duration;return{data:d,id:163}}))};l.data.push(c);g+=e}for(g=b=0;g<l.data.length;g++)3<=g&&(z.data[g-3].data[1].data[1].data=b),e=j([l.data[g]],a),b+=e.size||e.byteLength||e.length,2!=g&&(l.data[g]=e);return j(d,a)}function f(h){for(var a=h[0].width,d=h[0].height,l=h[0].duration,b=1;b<h.length;b++){if(h[b].width!=a)throw"Frame "+(b+1)+" has a different width";if(h[b].height!=d)throw"Frame "+(b+1)+" has a different height";if(0>h[b].duration||32767<h[b].duration)throw"Frame "+
(b+1)+" has a weird duration (must be between 0 and 32767)";l+=h[b].duration}return{duration:l,width:a,height:d}}function i(h){for(var a=[];0<h;)a.push(h&255),h>>=8;return new Uint8Array(a.reverse())}function e(h){for(var a=[],h=(h.length%8?Array(9-h.length%8).join("0"):"")+h,d=0;d<h.length;d+=8)a.push(parseInt(h.substr(d,8),2));return new Uint8Array(a)}function j(h,a){for(var d=[],l=0;l<h.length;l++)if("id"in h[l]){var b=h[l].data;"object"==typeof b&&(b=j(b,a));if("number"==typeof b)if("size"in h[l]){for(var c=
h[l].size,f=new Uint8Array(c),c=c-1;0<=c;c--)f[c]=b&255,b>>=8;b=f}else b=e(b.toString(2));if("string"==typeof b){f=new Uint8Array(b.length);for(c=0;c<b.length;c++)f[c]=b.charCodeAt(c);b=f}for(var c=b.size||b.byteLength||b.length,f=0,n=56;0<n;n-=7)if(c>Math.pow(2,n)-2){f=n/7;break}c=c.toString(2);n=Array(8*(f+1)+1).join("0");f=Array(f+1).join("0")+1;c=n.substr(0,n.length-c.length-f.length)+c;f+=c;d.push(i(h[l].id));d.push(e(f));d.push(b)}else d.push(h[l]);return a?(d=g(d),new Uint8Array(d)):new Blob(d,
{type:"video/webm"})}function g(h,a){null==a&&(a=[]);for(var d=0;d<h.length;d++)"object"==typeof h[d]?g(h[d],a):a.push(h[d]);return a}function n(h){var a=0;h.keyframe&&(a|=128);h.invisible&&(a|=8);h.lacing&&(a|=h.lacing<<1);h.discardable&&(a|=1);if(127<h.trackNum)throw"TrackNumber > 127 not supported";return[h.trackNum|128,h.timecode>>8,h.timecode&255,a].map(function(a){return String.fromCharCode(a)}).join("")+h.frame}function b(h){for(var a=h.RIFF[0].WEBP[0],d=a.indexOf("\u009d\u0001*"),b=0,c=[];4>
b;b++)c[b]=a.charCodeAt(d+3+b);b=c[1]<<8|c[0];d=b&16383;b=c[3]<<8|c[2];return{width:d,height:b&16383,data:a,riff:h}}function c(b){for(var a=0,d={};a<b.length;){var l=b.substr(a,4);d[l]=d[l]||[];if("RIFF"==l||"LIST"==l){var g=parseInt(b.substr(a+4,4).split("").map(function(a){a=a.charCodeAt(0).toString(2);return Array(8-a.length+1).join("0")+a}).join(""),2),e=b.substr(a+4+4,g),a=a+(8+g);d[l].push(c(e))}else"WEBP"==l?d[l].push(b.substr(a+8)):d[l].push(b.substr(a+4)),a=b.length}return d}function o(b){return[].slice.call(new Uint8Array((new Float64Array([b])).buffer),
0).map(function(a){return String.fromCharCode(a)}).reverse().join("")}function p(b,a){this.frames=[];this.duration=1E3/b;this.quality=a||0.8}p.prototype.add=function(b,a){if("undefined"!=typeof a&&this.duration)throw"you can't pass a duration if the fps is set";if("undefined"==typeof a&&!this.duration)throw"if you don't have the fps set, you need to have durations here.";b.canvas&&(b=b.canvas);if(b.toDataURL)b=b.getContext("2d").getImageData(0,0,b.width,b.height);else if("string"!=typeof b)throw"frame must be a a HTMLCanvasElement, a CanvasRenderingContext2D or a DataURI formatted string";
if("string"===typeof b&&!/^data:image\/webp;base64,/ig.test(b))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:b,duration:a||this.duration})};p.prototype.encodeFrames=function(b){if(this.frames[0].image instanceof ImageData){var a=this.frames,d=document.createElement("canvas"),l=d.getContext("2d");d.width=this.frames[0].image.width;d.height=this.frames[0].image.height;var c=function(g){var e=a[g];l.putImageData(e.image,0,0);e.image=d.toDataURL("image/webp",
this.quality);g<a.length-1?setTimeout(function(){c(g+1)},1):b()}.bind(this);c(0)}else b()};p.prototype.compile=function(h,a){this.encodeFrames(function(){var d=new k(this.frames.map(function(a){var d=b(c(atob(a.image.slice(23))));d.duration=a.duration;return d}),h);a(d)}.bind(this))};return{Video:p,fromImageArray:function(h,a,d){return k(h.map(function(d){d=b(c(atob(d.slice(23))));d.duration=1E3/a;return d}),d)},toWebM:k}}();(function(){function k(f){var e,j=new Uint8Array(f);for(e=0;e<f;e+=1)j[e]=0;return j}var f="A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,0,1,2,3,4,5,6,7,8,9,+,/".split(",");window.utils={};window.utils.clean=k;window.utils.pad=function(f,e,j){f=f.toString(j||8);return"000000000000".substr(f.length+12-e)+f};window.utils.extend=function(f,e,j,g){e=k((parseInt((e+j)/g)+1)*g);e.set(f);return e};window.utils.stringToUint8=function(f,e,j){var g,
n,e=e||k(f.length),j=j||0;for(g=0,n=f.length;g<n;g+=1)e[j]=f.charCodeAt(g),j+=1;return e};window.utils.uint8ToBase64=function(i){var e,j=i.length%3,g="",n;for(e=0,n=i.length-j;e<n;e+=3)j=(i[e]<<16)+(i[e+1]<<8)+i[e+2],g+=f[j>>18&63]+f[j>>12&63]+f[j>>6&63]+f[j&63];switch(g.length%4){case 1:g+="=";break;case 2:g+="=="}return g}})();
(function(){var k=window.utils,f;f=[{field:"fileName",length:100},{field:"fileMode",length:8},{field:"uid",length:8},{field:"gid",length:8},{field:"fileSize",length:12},{field:"mtime",length:12},{field:"checksum",length:8},{field:"type",length:1},{field:"linkName",length:100},{field:"ustar",length:8},{field:"owner",length:32},{field:"group",length:32},{field:"majorNumber",length:8},{field:"minorNumber",length:8},{field:"filenamePrefix",length:155},{field:"padding",length:12}];window.header={};window.header.structure=
f;window.header.format=function(i,e){var j=k.clean(512),g=0;f.forEach(function(e){var b=i[e.field]||"",c,f;for(c=0,f=b.length;c<f;c+=1)j[g]=b.charCodeAt(c),g+=1;g+=e.length-c});return"function"===typeof e?e(j,g):j}})();
(function(){function k(g){this.written=0;j=(g||20)*e;this.out=i.clean(j);this.blocks=[];this.length=0}var f=window.header,i=window.utils,e=512,j;k.prototype.append=function(g,j,b){var c,o,p,h,a,d;if("string"===typeof j)j=i.stringToUint8(j);else if(j.constructor!==Uint8Array.prototype.constructor)throw"Invalid input type. You gave me: "+j.constructor.toString().match(/function\s*([$A-Za-z_][0-9A-Za-z_]*)\s*\(/)[1];"function"===typeof b&&(b={});b=b||{};p=b.mode||511;h=b.mtime||Math.floor(+new Date/
1E3);a=b.uid||0;d=b.gid||0;c={fileName:g,fileMode:i.pad(p,7),uid:i.pad(a,7),gid:i.pad(d,7),fileSize:i.pad(j.length,11),mtime:i.pad(h,11),checksum:"        ",type:"0",ustar:"ustar  ",owner:b.owner||"",group:b.group||""};o=0;Object.keys(c).forEach(function(a){var d=c[a],b;for(a=0,b=d.length;a<b;a+=1)o+=d.charCodeAt(a)});c.checksum=i.pad(o,6)+"\x00 ";g=f.format(c);b=Math.ceil(g.length/e)*e;p=Math.ceil(j.length/e)*e;this.blocks.push({header:g,input:j,headerLength:b,inputLength:p})};k.prototype.save=function(){var g=
[],f=[],b=0,c=Math.pow(2,20),j=[];this.blocks.forEach(function(g){b+g.headerLength+g.inputLength>c&&(f.push({blocks:j,length:b}),j=[],b=0);j.push(g);b+=g.headerLength+g.inputLength});f.push({blocks:j,length:b});f.forEach(function(b){var c=new Uint8Array(b.length),a=0;b.blocks.forEach(function(d){c.set(d.header,a);a+=d.headerLength;c.set(d.input,a);a+=d.inputLength});g.push(c)});g.push(new Uint8Array(2*e));return new Blob(g,{type:"octet/stream"})};k.prototype.clear=function(){this.written=0;this.out=
i.clean(j)};window.Tar=k})();(function(k){function f(e,j){if({}.hasOwnProperty.call(f.cache,e))return f.cache[e];var g=f.resolve(e);if(!g)throw Error("Failed to resolve module "+e);var i={id:e,require:f,filename:e,exports:{},loaded:!1,parent:j,children:[]};j&&j.children.push(i);var b=e.slice(0,e.lastIndexOf("/")+1);return f.cache[e]=i.exports,g.call(i.exports,i,i.exports,b,e),i.loaded=!0,f.cache[e]=i.exports}f.modules={};f.cache={};f.resolve=function(e){return{}.hasOwnProperty.call(f.modules,e)?f.modules[e]:void 0};f.define=
function(e,j){f.modules[e]=j};var i=function(e){return e="/",{title:"browser",version:"v0.10.26",browser:!0,env:{},argv:[],nextTick:k.setImmediate||function(e){setTimeout(e,0)},cwd:function(){return e},chdir:function(f){e=f}}}();f.define("/gif.coffee",function(e){function j(b,c){function a(){this.constructor=b}for(var d in c)({}).hasOwnProperty.call(c,d)&&(b[d]=c[d]);return a.prototype=c.prototype,b.prototype=new a,b.__super__=c.prototype,b}var g,i,b,c,o;b=f("events",e).EventEmitter;g=f("/browser.coffee",
e);o=function(b){function e(a){var d,b;this.running=!1;this.options={};this.frames=[];this.freeWorkers=[];this.activeWorkers=[];this.setOptions(a);for(d in i)b=i[d],null!=this.options[d]||(this.options[d]=b)}return j(e,b),i={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null},c={delay:500,copy:!1},e.prototype.setOption=function(a,d){return this.options[a]=d,null!=this._canvas&&("width"===a||"height"===a)?this._canvas[a]=d:void 0},e.prototype.setOptions=
function(a){var d,b,c=[];for(d in a)({}).hasOwnProperty.call(a,d)&&(b=a[d],c.push(this.setOption(d,b)));return c},e.prototype.addFrame=function(a,d){var b,e;null==d&&(d={});b={};b.transparent=this.options.transparent;for(e in c)b[e]=d[e]||c[e];if(null!=this.options.width||this.setOption("width",a.width),null!=this.options.height||this.setOption("height",a.height),"undefined"!==typeof ImageData&&null!=ImageData&&a instanceof ImageData)b.data=a.data;else if("undefined"!==typeof CanvasRenderingContext2D&&
null!=CanvasRenderingContext2D&&a instanceof CanvasRenderingContext2D||"undefined"!==typeof WebGLRenderingContext&&null!=WebGLRenderingContext&&a instanceof WebGLRenderingContext)d.copy?b.data=this.getContextData(a):b.context=a;else if(null!=a.childNodes)d.copy?b.data=this.getImageData(a):b.image=a;else throw Error("Invalid image");return this.frames.push(b)},e.prototype.render=function(){var a;if(this.running)throw Error("Already running");if(!(null!=this.options.width&&null!=this.options.height))throw Error("Width and height must be set prior to rendering");
this.running=!0;this.nextFrame=0;this.finishedFrames=0;this.imageParts=function(a){for(var d=0,b=function(){var a;a=[];for(var d=0;0<=this.frames.length?d<this.frames.length:d>this.frames.length;0<=this.frames.length?++d:--d)a.push(d);return a}.apply(this,arguments).length;d<b;++d)a.push(null);return a}.call(this,[]);a=this.spawnWorkers();for(var d=0,b=function(){var d;d=[];for(var b=0;0<=a?b<a:b>a;0<=a?++b:--b)d.push(b);return d}.apply(this,arguments).length;d<b;++d)this.renderNextFrame();return this.emit("start"),
this.emit("progress",0)},e.prototype.abort=function(){for(var a;!(a=this.activeWorkers.shift(),null==a);){console.log("killing active worker");a.terminate()}return this.running=!1,this.emit("abort")},e.prototype.spawnWorkers=function(){var a;return a=Math.min(this.options.workers,this.frames.length),function(){var d;d=[];for(var b=this.freeWorkers.length;this.freeWorkers.length<=a?b<a:b>a;this.freeWorkers.length<=a?++b:--b)d.push(b);return d}.apply(this,arguments).forEach(function(a){return function(b){var c;
return console.log("spawning worker "+b),c=new Worker(a.options.workerScript),c.onmessage=function(a){return function(b){return a.activeWorkers.splice(a.activeWorkers.indexOf(c),1),a.freeWorkers.push(c),a.frameFinished(b.data)}}(a),a.freeWorkers.push(c)}}(this)),a},e.prototype.frameFinished=function(a){console.log("frame "+a.index+" finished - "+this.activeWorkers.length+" active");this.finishedFrames++;this.emit("progress",this.finishedFrames/this.frames.length);this.imageParts[a.index]=a;a:{for(var a=
this.imageParts,b=0,c=a.length;b<c;++b)if(b in a&&null===a[b]){a=!0;break a}a=!1}return a?this.renderNextFrame():this.finishRendering()},e.prototype.finishRendering=function(){var a,b,c,e,g,f,h;a=g=0;for(f=this.imageParts.length;a<f;++a)b=this.imageParts[a],g+=(b.data.length-1)*b.pageSize+b.cursor;g+=b.pageSize-b.cursor;console.log("rendering finished - filesize "+Math.round(g/1E3)+"kb");a=new Uint8Array(g);f=0;g=0;for(var j=this.imageParts.length;g<j;++g){b=this.imageParts[g];for(var i=0,m=b.data.length;i<
m;++i)h=b.data[i],c=i,a.set(h,f),c===b.data.length-1?f+=b.cursor:f+=b.pageSize}return e=new Blob([a],{type:"image/gif"}),this.emit("finished",e,a)},e.prototype.renderNextFrame=function(){var a,b,c;if(0===this.freeWorkers.length)throw Error("No free workers");return this.nextFrame>=this.frames.length?void 0:(a=this.frames[this.nextFrame++],c=this.freeWorkers.shift(),b=this.getTask(a),console.log("starting frame "+(b.index+1)+" of "+this.frames.length),this.activeWorkers.push(c),c.postMessage(b))},
e.prototype.getContextData=function(a){return a.getImageData(0,0,this.options.width,this.options.height).data},e.prototype.getImageData=function(a){var b;return null!=this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),b=this._canvas.getContext("2d"),b.setFill=this.options.background,b.fillRect(0,0,this.options.width,this.options.height),b.drawImage(a,0,0),this.getContextData(b)},e.prototype.getTask=function(a){var b,
c;if(b=this.frames.indexOf(a),c={index:b,last:b===this.frames.length-1,delay:a.delay,transparent:a.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,repeat:this.options.repeat,canTransfer:"chrome"===g.name},null!=a.data)c.data=a.data;else if(null!=a.context)c.data=this.getContextData(a.context);else if(null!=a.image)c.data=this.getImageData(a.image);else throw Error("Invalid frame");return c},e}(b);e.exports=o});f.define("/browser.coffee",function(e){var f,
g,i,b,c;b=navigator.userAgent.toLowerCase();i=navigator.platform.toLowerCase();c=b.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0];g="ie"===c[1]&&document.documentMode;f={name:"version"===c[1]?c[3]:c[1],version:g||parseFloat("opera"===c[1]&&c[4]?c[4]:c[2]),platform:{name:b.match(/ip(?:ad|od|hone)/)?"ios":(b.match(/(?:webos|android)/)||i.match(/mac|win|linux/)||["other"])[0]}};f[f.name]=!0;f[f.name+parseInt(f.version,10)]=!0;
f.platform[f.platform.name]=!0;e.exports=f});f.define("events",function(e,f){i.EventEmitter||(i.EventEmitter=function(){});var g=f.EventEmitter=i.EventEmitter,k="function"===typeof Array.isArray?Array.isArray:function(b){return"[object Array]"===Object.prototype.toString.call(b)};g.prototype.setMaxListeners=function(b){this._events||(this._events={});this._events.maxListeners=b};g.prototype.emit=function(b){if("error"===b&&(!this._events||!this._events.error||k(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof
Error?arguments[1]:Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var c=this._events[b];if(!c)return!1;if("function"!=typeof c){if(k(c)){for(var e=Array.prototype.slice.call(arguments,1),c=c.slice(),f=0,g=c.length;f<g;f++)c[f].apply(this,e);return!0}return!1}switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:e=Array.prototype.slice.call(arguments,1),c.apply(this,e)}return!0};
g.prototype.addListener=function(b,c){if("function"!==typeof c)throw Error("addListener only takes instances of Function");if(this._events||(this._events={}),this.emit("newListener",b,c),!this._events[b])this._events[b]=c;else if(k(this._events[b])){if(!this._events[b].warned){var e;void 0!==this._events.maxListeners?e=this._events.maxListeners:e=10;e&&0<e&&this._events[b].length>e&&(this._events[b].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",
this._events[b].length),console.trace())}this._events[b].push(c)}else this._events[b]=[this._events[b],c];return this};g.prototype.on=g.prototype.addListener;g.prototype.once=function(b,c){var e=this;return e.on(b,function h(){e.removeListener(b,h);c.apply(this,arguments)}),this};g.prototype.removeListener=function(b,c){if("function"!==typeof c)throw Error("removeListener only takes instances of Function");if(!this._events||!this._events[b])return this;var e=this._events[b];if(k(e)){var f=e.indexOf(c);
if(0>f)return this;e.splice(f,1);0==e.length&&delete this._events[b]}else this._events[b]===c&&delete this._events[b];return this};g.prototype.removeAllListeners=function(b){return b&&this._events&&this._events[b]&&(this._events[b]=null),this};g.prototype.listeners=function(b){return this._events||(this._events={}),this._events[b]||(this._events[b]=[]),k(this._events[b])||(this._events[b]=[this._events[b]]),this._events[b]}});k.GIF=f("/gif.coffee")}).call(this,this);(function(){function k(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}function f(a){var b={};this.settings=a;this.on=function(a,c){b[a]=c};this.emit=function(a){var c=b[a];c&&c.apply(null,Array.prototype.slice.call(arguments,1))};this.filename=a.name||k();this.mimeType=this.extension=""}function i(a){f.call(this,a);this.extension=".tar";this.mimeType="application/x-tar";this.fileExtension="";this.tape=null;
this.count=0}function e(a){i.call(this,a);this.type="image/png";this.fileExtension=".png"}function j(a){i.call(this,a);this.type="image/jpeg";this.fileExtension=".jpg";this.quality=a.quality/100||0.8}function g(a){"image/webp"!==document.createElement("canvas").toDataURL("image/webp").substr(5,10)&&console.log("WebP not supported - try another export format");f.call(this,a);a.quality=a.quality/100||0.8;this.extension=".webm";this.mimeType="video/webm";this.baseFilename=this.filename;this.frames=[];
this.part=1}function n(a){f.call(this,a);a.quality=a.quality/100||0.8;this.encoder=new FFMpegServer.Video(a);this.encoder.on("process",function(){this.emit("process")}.bind(this));this.encoder.on("finished",function(a,b){var c=this.callback;c&&(this.callback=void 0,c(a,b))}.bind(this));this.encoder.on("progress",function(a){if(this.settings.onProgress)this.settings.onProgress(a)}.bind(this));this.encoder.on("error",function(a){alert(JSON.stringify(a,null,2))}.bind(this))}function b(a){f.call(this,
a);this.framerate=this.settings.framerate;this.type="video/webm";this.extension=".webm";this.mediaRecorder=this.stream=null;this.chunks=[]}function c(a){f.call(this,a);a.quality=31-(30*a.quality/100||10);a.workers=a.workers||4;this.extension=".gif";this.mimeType="image/gif";this.canvas=document.createElement("canvas");this.ctx=this.canvas.getContext("2d");this.sizeSet=!1;this.encoder=new GIF({workers:a.workers,quality:a.quality,workerScript:a.workersPath+"gif.worker.js"});this.encoder.on("progress",
function(a){if(this.settings.onProgress)this.settings.onProgress(a)}.bind(this));this.encoder.on("finished",function(a){var b=this.callback;b&&(this.callback=void 0,b(a))}.bind(this))}function o(a){function d(){function a(){this._hooked||(this._hooked=!0,this._hookedTime=this.currentTime||0,this.pause(),K.push(this));return this._hookedTime+m.startTime}u("Capturer start");E=window.Date.now();v=E+m.startTime;F=window.performance.now();G=F+m.startTime;window.Date.prototype.getTime=function(){return v};
window.Date.now=function(){return v};window.setTimeout=function(a,b){var d={callback:a,time:b,triggerTime:v+b};x.push(d);u("Timeout set to "+d.time);return d};window.clearTimeout=function(a){for(var b=0;b<x.length;b++)x[b]==a&&(x.splice(b,1),u("Timeout cleared"))};window.setInterval=function(a,b){var d={callback:a,time:b,triggerTime:v+b};y.push(d);u("Interval set to "+d.time);return d};window.clearInterval=function(){u("clear Interval");return null};window.requestAnimationFrame=function(a){H.push(a)};
window.performance.now=function(){return G};Object.defineProperty(HTMLVideoElement.prototype,"currentTime",{get:a});Object.defineProperty(HTMLAudioElement.prototype,"currentTime",{get:a})}function f(){I=!1;r.stop();u("Capturer stop");window.setTimeout=C;window.setInterval=P;window.clearTimeout=Q;window.requestAnimationFrame=R;window.Date.prototype.getTime=S;window.Date.now=T;window.performance.now=U}function i(){C(o,0,void 0)}function k(){var a=w/m.framerate;if(m.frameLimit&&w>=m.frameLimit||m.timeLimit&&
a>=m.timeLimit)f(),p();var b=new Date(null);b.setSeconds(a);t.textContent=2<m.motionBlurFrames?"CCapture "+m.format+" | "+w+" frames ("+A+" inter) | "+b.toISOString().substr(11,8):"CCapture "+m.format+" | "+w+" frames | "+b.toISOString().substr(11,8)}function o(){var a=(w+A/m.motionBlurFrames)*(1E3/m.framerate);v=E+a;G=F+a;K.forEach(function(b){b._hookedTime=a/1E3});k();u("Frame: "+w+" "+A);for(var b=0;b<x.length;b++)v>=x[b].triggerTime&&(C(x[b].callback,0,void 0),x.splice(b,1));for(b=0;b<y.length;b++)v>=
y[b].triggerTime&&(C(y[b].callback,0,void 0),y[b].triggerTime+=y[b].time);H.forEach(function(a){C(a,0,v-h)});H=[]}function p(a){a||(a=function(a){download(a,r.filename+r.extension,r.mimeType);return!1});r.save(a)}function u(a){J&&console.log(a)}function O(a){var b=L[a];b&&b.apply(null,Array.prototype.slice.call(arguments,1))}var m=a||{},J,v,E,G,F,r,x=[],y=[],w=0,A=0,H=[],I=!1,L={};m.framerate=m.framerate||60;m.motionBlurFrames=2*(m.motionBlurFrames||1);J=m.verbose||!1;m.step=1E3/m.framerate;m.timeLimit=
m.timeLimit||0;m.frameLimit=m.frameLimit||0;m.startTime=m.startTime||0;var t=document.createElement("div");t.style.position="absolute";t.style.left=t.style.top=0;t.style.backgroundColor="black";t.style.fontFamily="monospace";t.style.fontSize="11px";t.style.padding="5px";t.style.color="red";t.style.zIndex=1E5;m.display&&document.body.appendChild(t);var s=document.createElement("canvas"),D=s.getContext("2d"),q,B;u("Step is set to "+m.step+"ms");var a={gif:c,webm:g,ffmpegserver:n,png:e,jpg:j,"webm-mediarecorder":b},
M=a[m.format];if(!M)throw"Error: Incorrect or missing format: Valid formats are "+Object.keys(a).join(", ");r=new M(m);r.step=i;r.on("process",o);r.on("progress",function(a){O("progress",a)});!1=="performance"in window&&(window.performance={});Date.now=Date.now||function(){return(new Date).getTime()};if(!1=="now"in window.performance){var N=Date.now();performance.timing&&performance.timing.navigationStart&&(N=performance.timing.navigationStart);window.performance.now=function(){return Date.now()-
N}}var C=window.setTimeout,P=window.setInterval,Q=window.clearTimeout,R=window.requestAnimationFrame,T=window.Date.now,U=window.performance.now,S=window.Date.prototype.getTime,K=[];return{start:function(){d();r.start();I=!0},capture:function(a){if(I)if(2<m.motionBlurFrames){if(s.width!==a.width||s.height!==a.height)s.width=a.width,s.height=a.height,q=new Uint16Array(4*s.height*s.width),D.fillStyle="#0",D.fillRect(0,0,s.width,s.height);D.drawImage(a,0,0);B=D.getImageData(0,0,s.width,s.height);for(a=
0;a<q.length;a+=4)q[a]+=B.data[a],q[a+1]+=B.data[a+1],q[a+2]+=B.data[a+2];A++;if(A>=0.5*m.motionBlurFrames){for(var a=B.data,b=0;b<q.length;b+=4)a[b]=2*q[b]/m.motionBlurFrames,a[b+1]=2*q[b+1]/m.motionBlurFrames,a[b+2]=2*q[b+2]/m.motionBlurFrames;D.putImageData(B,0,0);r.add(s);w++;A=0;u("Full MB Frame! "+w+" "+v);for(b=0;b<q.length;b+=4)q[b]=0,q[b+1]=0,q[b+2]=0;gc()}else i()}else r.add(a),w++,u("Full Frame! "+w)},stop:f,save:p,on:function(a,b){L[a]=b}}}var p="object"==typeof self&&self.self===self&&
self||"object"==typeof global&&global.global===global&&global||this;"gc"in window||(window.gc=function(){});HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(a,b,c){for(var c=atob(this.toDataURL(b,c).split(",")[1]),e=c.length,f=new Uint8Array(e),g=0;g<e;g++)f[g]=c.charCodeAt(g);a(new Blob([f],{type:b||"image/png"}))}});(function(){!1=="performance"in window&&(window.performance={});Date.now=Date.now||function(){return(new Date).getTime()};
if(!1=="now"in window.performance){var a=Date.now();performance.timing&&performance.timing.navigationStart&&(a=performance.timing.navigationStart);window.performance.now=function(){return Date.now()-a}}})();var h=window.Date.now();f.prototype.start=function(){};f.prototype.stop=function(){};f.prototype.add=function(){};f.prototype.save=function(){};f.prototype.dispose=function(){};f.prototype.safeToProceed=function(){return!0};f.prototype.step=function(){console.log("Step not set!")};i.prototype=
Object.create(f.prototype);i.prototype.start=function(){this.dispose()};i.prototype.add=function(a){var b=new FileReader;b.onload=function(){this.tape.append(("0000000"+this.count).slice(-7)+this.fileExtension,new Uint8Array(b.result));this.count++;this.step()}.bind(this);b.readAsArrayBuffer(a)};i.prototype.save=function(a){a(this.tape.save())};i.prototype.dispose=function(){this.tape=new Tar;this.count=0};e.prototype=Object.create(i.prototype);e.prototype.add=function(a){a.toBlob(function(a){i.prototype.add.call(this,
a)}.bind(this),this.type)};j.prototype=Object.create(i.prototype);j.prototype.add=function(a){a.toBlob(function(a){i.prototype.add.call(this,a)}.bind(this),this.type,this.quality)};g.prototype=Object.create(f.prototype);g.prototype.start=function(){this.dispose()};g.prototype.add=function(a){this.frames.push(a.toDataURL("image/webp",this.quality));0<this.settings.autoSaveTime&&this.frames.length/this.settings.framerate>=this.settings.autoSaveTime?this.save(function(a){this.filename=this.baseFilename+
"-part-"+("0000000"+this.part).slice(-7);download(a,this.filename+this.extension,this.mimeType);this.dispose();this.part++;this.filename=this.baseFilename+"-part-"+("0000000"+this.part).slice(-7);this.step()}.bind(this)):this.step()};g.prototype.save=function(a){if(this.frames.length){var b=Whammy.fromImageArray(this.frames,this.settings.framerate),b=new Blob([b],{type:"octet/stream"});a(b)}};g.prototype.dispose=function(){this.frames=[]};n.prototype=Object.create(f.prototype);n.prototype.start=function(){this.encoder.start(this.settings)};
n.prototype.add=function(a){this.encoder.add(a)};n.prototype.save=function(a){this.callback=a;this.encoder.end()};n.prototype.safeToProceed=function(){return this.encoder.safeToProceed()};b.prototype=Object.create(f.prototype);b.prototype.add=function(a){this.stream||(this.stream=a.captureStream(this.framerate),this.mediaRecorder=new MediaRecorder(this.stream),this.mediaRecorder.start(),this.mediaRecorder.ondataavailable=function(a){this.chunks.push(a.data)}.bind(this));this.step()};b.prototype.save=
function(a){this.mediaRecorder.onstop=function(){var b=new Blob(this.chunks,{type:"video/webm"});this.chunks=[];a(b)}.bind(this);this.mediaRecorder.stop()};c.prototype=Object.create(f.prototype);c.prototype.add=function(a){this.sizeSet||(this.encoder.setOption("width",a.width),this.encoder.setOption("height",a.height),this.sizeSet=!0);this.canvas.width=a.width;this.canvas.height=a.height;this.ctx.drawImage(a,0,0);this.encoder.addFrame(this.ctx,{copy:!0,delay:this.settings.step});this.step()};c.prototype.save=
function(a){this.callback=a;this.encoder.render()};"undefined"!=typeof exports&&!exports.nodeType?("undefined"!=typeof module&&!module.nodeType&&module.exports&&(exports=module.exports=o),exports.CCapture=o):p.CCapture=o;"function"==typeof define&&define.amd&&define("CCapture",[],function(){return o})})();
