function CCapture(b){function k(){f("Incrementing time");e+=h;l++;for(var a=0;a<c.length;a++)e>=c[a].triggerTime&&(c[a].callback(),console.log("timeout!"),c.splice(a,1));d&&d()}function f(a){i&&console.log(a)}var b=b||{},m=new Date,i,e,h,c=[],l=0,d=null,g=!1;b.framerate=b.framerate||60;i=b.verbose||!1;h=1E3/b.framerate;var j=new Whammy.Video(b.framerate),n=setTimeout;(function(){f("Capturer start");e=m.getTime();Date.prototype.getTime=function(){return e};setTimeout=function(a,b){var d={callback:a,
time:b,triggerTime:e+b};c.push(d);f("Timeout set to "+d.time);return d};clearTimeout=function(a){for(var b=0;b<c.length;b++)c[b]==a&&(c.splice(b,1),f("Timeout cleared"))};requestAnimationFrame=function(a){d=a}})();return{start:function(){g=!0},capture:function(a){g&&(j.add(a),f("Frame saved"));n(k,1)},stop:function(){g=!1},save:function(){var a=j.compile();return(window.webkitURL||window.URL).createObjectURL(a)}}};
